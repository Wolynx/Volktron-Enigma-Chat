<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Volktronic Crypto</title>

<!-- FIREBASE v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  background:#020617;color:#fff;
  font-family:Segoe UI;
  display:flex;justify-content:center;align-items:center;
  min-height:100vh;margin:0
}
.hidden{display:none}
.card,.container{
  background:#0b122a;padding:25px;
  border-radius:20px;width:380px
}
.container{width:900px}
input,textarea,button{
  width:100%;margin-top:10px;
  padding:12px;border-radius:10px;border:none
}
button{font-weight:bold;cursor:pointer}
.primary{background:#25d9f0;color:#000}
.msg{padding:8px;margin-top:6px;border-radius:8px}
.me{background:#00ffd5;color:#000}
.other{background:#111}
.layers{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
.layer{background:#1e90ff;padding:8px;border-radius:8px;cursor:pointer}
.layer.active{background:#00ffd5;color:#000}
</style>
</head>

<body>

<div class="card" id="login">
  <h2>üîê Volktronic Crypto</h2>
  <input id="username" placeholder="Kullanƒ±cƒ± adƒ±">
  <input id="room" placeholder="Oda">
  <input id="secret" placeholder="Gizli anahtar">
  <button class="primary" onclick="enterRoom()">Odaya Gir</button>
</div>

<div class="container hidden" id="chat">
  <h3>Oda: <span id="roomName"></span></h3>

  <div class="layers" id="encLayers"></div>
  <textarea id="message"></textarea>
  <button class="primary" onclick="sendMsg()">G√∂nder</button>

  <hr>

  <textarea id="cipher"></textarea>
  <button onclick="decrypt()">√á√∂z</button>
  <div id="result"></div>

  <div id="log"></div>
</div>

<script>
/* === FIREBASE INIT === */
firebase.initializeApp({
  databaseURL:"https://volktron-chat-default-rtdb.firebaseio.com/"
});
const db=firebase.database();

/* === STATE === */
let USER="", ROOM="", roomRef;
const encSel=new Set();

/* === XOR CRYPTO === */
function xorCrypt(t,k){
  return [...t].map((c,i)=>
    String.fromCharCode(c.charCodeAt(0)^k.charCodeAt(i%k.length))
  ).join("");
}

/* === UI LAYERS === */
for(let i=1;i<=10;i++){
  const d=document.createElement("div");
  d.className="layer";
  d.textContent="Katman "+i;
  d.onclick=()=>{encSel.has(i)?encSel.delete(i):encSel.add(i);d.classList.toggle("active")};
  encLayers.appendChild(d);
}

/* === LOGIN === */
function enterRoom(){
  USER=username.value.trim();
  ROOM=room.value.trim();
  if(!USER||!ROOM||!secret.value){
    alert("Eksik bilgi");return;
  }

  login.classList.add("hidden");
  chat.classList.remove("hidden");
  roomName.textContent=ROOM;

  roomRef=db.ref("rooms/"+ROOM);
  roomRef.on("child_added",s=>{
    const d=s.val();
    const div=document.createElement("div");
    div.className="msg "+(d.user===USER?"me":"other");
    div.textContent=d.user+": "+d.text;
    div.onclick=()=>cipher.value=d.text;
    log.appendChild(div);
  });
}

/* === SEND === */
function sendMsg(){
  if(!message.value)return;
  const enc=xorCrypt(message.value,secret.value);
  roomRef.push({user:USER,text:enc,time:Date.now()});
  message.value="";
}

/* === DECRYPT === */
function decrypt(){
  result.textContent="√á√∂z√ºm: "+xorCrypt(cipher.value,secret.value);
}
</script>

</body>
</html>
